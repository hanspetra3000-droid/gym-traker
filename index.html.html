<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gym Tracker ‚Äì Push/Pull/Beine/Laufband</title>
  <style>
    :root{
      --bg: #0f1115;
      --card:#171a21;
      --muted:#9aa4b2;
      --text:#e7ecf3;
      --accent:#4ade80; /* gr√ºn */
      --danger:#ef4444;
      --warning:#f59e0b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --bg-image: url('background.jpg');

    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif; 
      color:var(--text); background: var(--bg);
      background-image: var(--bg-image);
      background-size: cover; background-position: center; background-attachment: fixed;
    }
    .app{max-width:900px; margin-inline:auto; padding:12px 12px 96px}
    header{
      position:sticky; top:0; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(15,17,21,.9), rgba(15,17,21,.6));
      z-index:5; padding:12px; border-bottom:1px solid #2a2f3a
    }
    h1{font-size:20px; margin:0 0 8px}
    .tabs{display:grid; grid-template-columns:repeat(4,1fr); gap:8px}
    .tab-btn{
      appearance:none; border:0; padding:10px 8px; border-radius:12px; 
      background:var(--card); color:var(--text); box-shadow: var(--shadow);
      text-transform:capitalize; font-weight:600
    }
    .tab-btn.active{outline:2px solid var(--accent)}

    .card{background:rgba(23,26,33,.85); border:1px solid #2a2f3a; border-radius: var(--radius); box-shadow: var(--shadow); padding:12px;}
    .row{display:flex; gap:8px; align-items:center;}
    .row.wrap{flex-wrap:wrap}
    .row + .row{margin-top:8px}
    label{font-size:12px; color:var(--muted)}
    input, select{width:100%; background:#0e1117; color:var(--text); border:1px solid #2a2f3a; border-radius:12px; padding:12px; font-size:16px}
    input::placeholder{color:#7b8594}
    .btn{appearance:none; border:0; padding:12px 14px; border-radius:12px; font-weight:700; cursor:pointer}
    .btn.primary{background:var(--accent); color:#0a0f0a}
    .btn.ghost{background:transparent; border:1px solid #2a2f3a; color:var(--text)}
    .btn.danger{background:var(--danger)}

    .list{margin-top:10px; display:grid; gap:8px}
    .item{display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; background:#0e1117; border:1px solid #2a2f3a; border-radius:12px; padding:12px}
    .item-title{font-weight:700}
    .item-sub{font-size:12px; color:var(--muted)}
    .item-actions{display:flex; gap:6px}

    .footer-spacer{height:96px}

    /* Floating Timer Button */
    .fab{
      position:fixed; right:16px; bottom:16px; z-index:10;
      width:64px; height:64px; border-radius:50%; display:grid; place-items:center; 
      background:var(--accent); color:#0a0f0a; font-size:26px; font-weight:900; box-shadow: var(--shadow); border:0; cursor:pointer
    }

    /* Timer modal */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); z-index:20}
    .modal.show{display:grid}
    .timer-card{width:min(520px,92vw); background:#0e1117; border:1px solid #2a2f3a; border-radius:24px; padding:20px; box-shadow:var(--shadow); text-align:center}
    .timer-display{font-variant-numeric:tabular-nums; font-size:64px; letter-spacing:1px; margin:8px 0 16px}
    .timer-controls{display:flex; gap:8px; justify-content:center}
    
    /* Toolbar */
    .toolbar{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .toolbar small{color:var(--muted)}

    /* Background upload */
    .bg-uploader{display:flex; gap:8px; align-items:center}

    @media (hover:hover){
      .tab-btn:hover{filter:brightness(1.08)}
      .btn:hover{filter:brightness(1.05)}
    }
  </style>
</head>
<body>
  <header>
    <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è Gym Tracker</h1>
    <div class="tabs">
      <button class="tab-btn active" data-tab="push">Push</button>
      <button class="tab-btn" data-tab="pull">Pull</button>
      <button class="tab-btn" data-tab="beine">Beine</button>
      <button class="tab-btn" data-tab="laufband">Laufband</button>
    </div>
    <div class="toolbar">
      <small>Alle Eintr√§ge werden automatisch lokal gespeichert.</small>
      <span style="flex:1"></span>
      <label class="bg-uploader">
        <span class="btn ghost" title="Hintergrundbild setzen">Hintergrund</span>
        <input id="bgInput" type="file" accept="image/*" style="display:none" />
      </label>
      <button id="exportBtn" class="btn ghost" title="Daten exportieren">Export</button>
      <button id="importBtn" class="btn ghost" title="Daten importieren">Import</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>
  </header>

  <main class="app">
    <!-- Push -->
    <section class="tab card" id="tab-push">
      <h2>Push</h2>
      <div class="row wrap">
        <div style="flex:2; min-width:200px">
          <label>√úbung</label>
          <input id="push-name" placeholder="z.B. Bankdr√ºcken" />
        </div>
        <div style="flex:1; min-width:140px">
          <label>Gewicht (kg)</label>
          <input id="push-kg" inputmode="decimal" placeholder="z.B. 60" />
        </div>
        <button class="btn primary" id="push-add" style="min-width:120px">Hinzuf√ºgen</button>
      </div>
      <div class="list" id="push-list"></div>
    </section>

    <!-- Pull -->
    <section class="tab card" id="tab-pull" style="display:none">
      <h2>Pull</h2>
      <div class="row wrap">
        <div style="flex:2; min-width:200px">
          <label>√úbung</label>
          <input id="pull-name" placeholder="z.B. Klimmz√ºge" />
        </div>
        <div style="flex:1; min-width:140px">
          <label>Gewicht (kg)</label>
          <input id="pull-kg" inputmode="decimal" placeholder="z.B. 20 (Zugmaschine)" />
        </div>
        <button class="btn primary" id="pull-add" style="min-width:120px">Hinzuf√ºgen</button>
      </div>
      <div class="list" id="pull-list"></div>
    </section>

    <!-- Beine -->
    <section class="tab card" id="tab-beine" style="display:none">
      <h2>Beine</h2>
      <div class="row wrap">
        <div style="flex:2; min-width:200px">
          <label>√úbung</label>
          <input id="beine-name" placeholder="z.B. Kniebeuge" />
        </div>
        <div style="flex:1; min-width:140px">
          <label>Gewicht (kg)</label>
          <input id="beine-kg" inputmode="decimal" placeholder="z.B. 80" />
        </div>
        <button class="btn primary" id="beine-add" style="min-width:120px">Hinzuf√ºgen</button>
      </div>
      <div class="list" id="beine-list"></div>
    </section>

    <!-- Laufband -->
    <section class="tab card" id="tab-laufband" style="display:none">
      <h2>Laufband</h2>
      <div class="row wrap">
        <div style="flex:1; min-width:140px">
          <label>Entfernung (km)</label>
          <input id="run-dist" inputmode="decimal" placeholder="z.B. 3.5" />
        </div>
        <div style="flex:1; min-width:140px">
          <label>Zeit (MM:SS oder HH:MM:SS)</label>
          <input id="run-time" inputmode="numeric" placeholder="z.B. 20:30" />
        </div>
        <button class="btn primary" id="run-add" style="min-width:120px">Hinzuf√ºgen</button>
      </div>
      <div class="list" id="run-list"></div>
    </section>

    <div class="footer-spacer"></div>
  </main>

  <!-- Floating 2-Min Timer Button -->
  <button class="fab" id="timerFab" title="2-Minuten Pause">‚è±Ô∏è</button>

  <!-- Timer Modal -->
  <div class="modal" id="timerModal" role="dialog" aria-modal="true">
    <div class="timer-card">
      <h3>Pause-Timer</h3>
      <div class="timer-display" id="timerDisplay">02:00</div>
      <div class="timer-controls">
        <button class="btn primary" id="timerStart">Start</button>
        <button class="btn ghost" id="timerStop">Stopp</button>
        <button class="btn danger" id="timerReset">Zur√ºcksetzen</button>
        <button class="btn ghost" id="timerClose">Schlie√üen</button>
      </div>
      <p style="color:var(--muted); margin-top:10px">Tipp: Bildschirm eingeschaltet lassen, damit der Timer sichtbar bleibt.</p>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = sel => document.querySelector(sel);
    const store = {
      get(k, fallback){
        try{ return JSON.parse(localStorage.getItem(k)) ?? fallback }catch{ return fallback }
      },
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)) }
    }
    const KEYS = {
      push: 'gt_push_v1', pull: 'gt_pull_v1', beine:'gt_beine_v1', run:'gt_run_v1', bg:'gt_bg_v1'
    }

    function renderList(kind){
      const data = store.get(KEYS[kind], []);
      const list = document.getElementById(kind+'-list');
      list.innerHTML = '';
      data.forEach((item, idx)=>{
        const el = document.createElement('div');
        el.className = 'item';
        const left = document.createElement('div');
        const t = document.createElement('div'); t.className='item-title';
        const s = document.createElement('div'); s.className='item-sub';
        if(kind==='laufband' || kind==='run'){
          t.textContent = `${item.dist} km in ${item.time}`;
          s.textContent = item.date || '';
        } else {
          t.textContent = item.name || '‚Äî';
          s.textContent = (item.kg? item.kg+ ' kg' : '');
        }
        left.appendChild(t); left.appendChild(s);
        const act = document.createElement('div'); act.className='item-actions';
        const edit = document.createElement('button'); edit.className='btn ghost'; edit.textContent='Bearb.';
        const del = document.createElement('button'); del.className='btn danger'; del.textContent='L√∂schen';
        edit.addEventListener('click', ()=> editItem(kind, idx));
        del.addEventListener('click', ()=> deleteItem(kind, idx));
        act.appendChild(edit); act.appendChild(del);
        el.appendChild(left); el.appendChild(act);
        list.appendChild(el);
      })
    }

    function addItem(kind, payload){
      const key = KEYS[kind];
      const data = store.get(key, []);
      data.push(payload);
      store.set(key, data);
      renderList(kind);
    }

    function editItem(kind, idx){
      const key = KEYS[kind];
      const data = store.get(key, []);
      const item = data[idx];
      if(kind==='run' || kind==='laufband'){
        const dist = prompt('Entfernung (km):', item.dist);
        if(dist===null) return;
        const time = prompt('Zeit (MM:SS oder HH:MM:SS):', item.time);
        if(time===null) return;
        data[idx] = {dist: sanitizeNumber(dist), time: time.trim(), date: item.date};
      } else {
        const name = prompt('√úbung:', item.name ?? '');
        if(name===null) return;
        const kg = prompt('Gewicht (kg):', item.kg ?? '');
        if(kg===null) return;
        data[idx] = {name: name.trim(), kg: sanitizeNumber(kg)};
      }
      store.set(key, data);
      renderList(kind);
    }

    function deleteItem(kind, idx){
      const key = KEYS[kind];
      const data = store.get(key, []);
      data.splice(idx,1);
      store.set(key, data);
      renderList(kind);
    }

    function sanitizeNumber(v){
      // erlaubt Komma oder Punkt, gibt String zur√ºck ‚Äì Anzeigezweck
      if(v==null) return '';
      return String(v).replace(',', '.').replace(/[^0-9.]/g,'');
    }

    // ---------- Tabs ----------
    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn=> btn.addEventListener('click', ()=>{
      tabButtons.forEach(b=> b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      document.querySelectorAll('.tab').forEach(s=> s.style.display='none');
      const map = {push:'#tab-push', pull:'#tab-pull', beine:'#tab-beine', laufband:'#tab-laufband'}
      $(map[tab]).style.display='block';
    }))

    // ---------- Add handlers ----------
    $('#push-add').addEventListener('click', ()=>{
      const name = $('#push-name').value.trim();
      const kg = sanitizeNumber($('#push-kg').value);
      if(!name) return alert('Bitte √úbung eingeben');
      addItem('push', {name, kg});
      $('#push-name').value=''; $('#push-kg').value='';
    })

    $('#pull-add').addEventListener('click', ()=>{
      const name = $('#pull-name').value.trim();
      const kg = sanitizeNumber($('#pull-kg').value);
      if(!name) return alert('Bitte √úbung eingeben');
      addItem('pull', {name, kg});
      $('#pull-name').value=''; $('#pull-kg').value='';
    })

    $('#beine-add').addEventListener('click', ()=>{
      const name = $('#beine-name').value.trim();
      const kg = sanitizeNumber($('#beine-kg').value);
      if(!name) return alert('Bitte √úbung eingeben');
      addItem('beine', {name, kg});
      $('#beine-name').value=''; $('#beine-kg').value='';
    })

    $('#run-add').addEventListener('click', ()=>{
      const dist = sanitizeNumber($('#run-dist').value);
      const time = $('#run-time').value.trim();
      if(!dist || !time) return alert('Bitte Entfernung und Zeit eingeben');
      const today = new Date();
      const dateStr = today.toLocaleDateString(undefined, {year:'numeric', month:'2-digit', day:'2-digit'});
      addItem('run', {dist, time, date: dateStr});
      $('#run-dist').value=''; $('#run-time').value='';
    })

    // ---------- Initial render ----------
    renderList('push'); renderList('pull'); renderList('beine');
    // Laufband wurde unter Key 'run' gespeichert
    (function fixRunKey(){
      // wir rendern unter run-list, mappen entsprechend
      const data = store.get(KEYS.run, []);
      const list = document.getElementById('run-list');
      list.innerHTML='';
      data.forEach((item, idx)=>{
        const el = document.createElement('div'); el.className='item';
        const left = document.createElement('div');
        const t = document.createElement('div'); t.className='item-title'; t.textContent = `${item.dist} km in ${item.time}`;
        const s = document.createElement('div'); s.className='item-sub'; s.textContent = item.date || '';
        left.appendChild(t); left.appendChild(s);
        const act = document.createElement('div'); act.className='item-actions';
        const edit = document.createElement('button'); edit.className='btn ghost'; edit.textContent='Bearb.';
        const del = document.createElement('button'); del.className='btn danger'; del.textContent='L√∂schen';
        edit.addEventListener('click', ()=>{
          const dist = prompt('Entfernung (km):', item.dist);
          if(dist===null) return;
          const time = prompt('Zeit (MM:SS oder HH:MM:SS):', item.time);
          if(time===null) return;
          const data2 = store.get(KEYS.run, []);
          data2[idx] = {dist: sanitizeNumber(dist), time: time.trim(), date: item.date};
          store.set(KEYS.run, data2);
          fixRunKey();
        });
        del.addEventListener('click', ()=>{
          const data2 = store.get(KEYS.run, []);
          data2.splice(idx,1);
          store.set(KEYS.run, data2);
          fixRunKey();
        });
        act.appendChild(edit); act.appendChild(del);
        el.appendChild(left); el.appendChild(act);
        list.appendChild(el);
      })
    })();

    // ---------- Export / Import ----------
    $('#exportBtn').addEventListener('click', ()=>{
      const payload = {
        push: store.get(KEYS.push, []),
        pull: store.get(KEYS.pull, []),
        beine: store.get(KEYS.beine, []),
        laufband: store.get(KEYS.run, []),
        bg: store.get(KEYS.bg, null)
      }
      const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'gym-tracker-export.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    })

    $('#importBtn').addEventListener('click', ()=> $('#importFile').click());
    $('#importFile').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const data = JSON.parse(reader.result);
          if(data.push) store.set(KEYS.push, data.push);
          if(data.pull) store.set(KEYS.pull, data.pull);
          if(data.beine) store.set(KEYS.beine, data.beine);
          if(data.laufband) store.set(KEYS.run, data.laufband);
          if(data.bg){
            store.set(KEYS.bg, data.bg);
            document.body.style.setProperty('--bg-image', `url(${data.bg})`);
          }
          renderList('push'); renderList('pull'); renderList('beine');
          // refresh run
          (function(){
            const event = new Event('refreshRun');
            window.dispatchEvent(event);
          })();
          location.reload();
        }catch(err){ alert('Import fehlgeschlagen: ' + err.message) }
      }
      reader.readAsText(file);
      e.target.value='';
    })

    // ---------- 2-Minuten Timer ----------
    const modal = $('#timerModal');
    const disp = $('#timerDisplay');
    let remaining = 120; // seconds
    let intv = null;

    function fmt(sec){
      const m = Math.floor(sec/60).toString().padStart(2,'0');
      const s = Math.floor(sec%60).toString().padStart(2,'0');
      return m+':'+s;
    }
    function update(){ disp.textContent = fmt(remaining) }
    function tick(){
      remaining -= 1; update();
      if(remaining<=0){
        clearInterval(intv); intv=null; remaining=0; update();
        try{ navigator.vibrate && navigator.vibrate([200,100,200,100,400]); }catch{}
        alert('Pause vorbei!');
      }
    }

    $('#timerFab').addEventListener('click', ()=>{ modal.classList.add('show'); remaining=120; update(); })
    $('#timerStart').addEventListener('click', ()=>{ if(intv) return; intv = setInterval(tick, 1000) })
    $('#timerStop').addEventListener('click', ()=>{ if(intv){ clearInterval(intv); intv=null } })
    $('#timerReset').addEventListener('click', ()=>{ remaining=120; update(); })
    $('#timerClose').addEventListener('click', ()=>{ if(intv){ clearInterval(intv); intv=null } modal.classList.remove('show') })

    // ---------- Hintergrundbild Upload ----------
    const bgInput = $('#bgInput');
    const savedBg = store.get(KEYS.bg, null);
    if(savedBg){ document.body.style.setProperty('--bg-image', `url(${savedBg})`) }

    bgInput?.addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        const dataUrl = reader.result;
        store.set(KEYS.bg, dataUrl);
        document.body.style.setProperty('--bg-image', `url(${dataUrl})`);
      }
      reader.readAsDataURL(file);
      e.target.value='';
    })

    // ---------- Accessibility niceties ----------
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Escape' && modal.classList.contains('show')){
        $('#timerClose').click();
      }
    })
  </script>
</body>
</html>
